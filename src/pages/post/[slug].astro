---
import AstroLayout from "../../layouts/layout.astro";
import Post from "../../components/Post/Post";
import type { TPost } from "../../models/model";

const { slug } = Astro.params;
const query = {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `{
      post(where: {slug: "${slug}"}) {
        title
        id
        slug
        publishedAt
        content
        date
        tags
        authors {
          name
          picture {
            url
            fileName
          }
        }
        coverImage {
          fileName
          url
          height
          width
        }
      }
    }
  `,
  }),
};

const response = await fetch(import.meta.env.HYGRAPH_ENDPOINT, query);
const json = await response.json();
const post: TPost = json.data.post;
if (!post) return Astro.redirect("/404");

---

<AstroLayout>
  <Post post={post} />
</AstroLayout>