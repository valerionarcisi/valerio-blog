---
import AstroLayout from "../../layouts/layout.astro";
import Post from "../../components/Post/Post";
import { getAndParsePostDetail } from "../../services/hygraph";
import { Effect } from "effect";

const { slug } = Astro.params;

const post = await Effect.runPromise(
  getAndParsePostDetail(`{
      post(where: {slug: "${slug}"}) {
        title
        id
        slug
        publishedAt
        content
        date
        tags
        extract
        authors {
          name
          picture {
            url
            fileName
          }
        }
        coverImage {
          fileName
          url
          height
          width
        }
      }
    }
  `)
)
  .then((data) => data.data.post)
  .catch((error) => error);

if (!post) return Astro.redirect("/404");

---

<AstroLayout
  seo={{
    title: `${post.title} | Valerio Narcisi Blog`,
    description: post.extract ? post.extract : "",
    image: post.coverImage?.url,
    type: "article",
  }}
>
  <Post post={post} />
</AstroLayout>
