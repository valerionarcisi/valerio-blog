---
import AstroLayout from "../layouts/layout.astro";
import Home from "../components/Home/Home";
import { getAndParseHyAllPosts } from "../utils/hygraph";
import { Effect } from "effect";
import { getAndParseRecentTraks } from "../utils/audioscrobbler";
import { program } from "../utils/letterboxd";

const music = await Effect.runPromise(getAndParseRecentTraks())
  .then((data) => data)
  .then((data) => data.recenttracks.track[0])
  .catch((error) => error);

const movie = await Effect.runPromise(program)
  .then((data) => data)
  .catch((error) => error);

const posts = await Effect.runPromise(
  getAndParseHyAllPosts(`{
      posts(orderBy: publishedAt_DESC, last: 5) {
        id,
        title,
        slug,
        publishedAt,
        tags,
        extract
        coverImage {
          id,
          url,
          fileName,
        }
      }
    }
  `)
)
  .then((data) => data.data?.posts || [])
  .catch((error) => error);

---

<AstroLayout
  seo={{
    title: `Home | Valerio Narcisi - web developer, director and screenwriter`,
    description:
      "Valerio Narcisi web developer, director and screenwriter. This is my personal blog where I post my thoughts on technology, movies books and other things.",
    name: `Home | Valerio Narcisi - web developer, director and screenwriter`,
    type: "website",
  }}
>
  <Home posts={posts} lastTrack={music} lastMovie={movie} />
</AstroLayout>
