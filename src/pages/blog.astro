---
import AstroLayout from "../layouts/layout.astro";
import BlogComponent from "../components/Blog/Blog";
import { getAndParseHyAllPosts } from "../services/hygraph";
import { Effect } from "effect";

const posts = await Effect.runPromise(
  getAndParseHyAllPosts(`{
      posts(orderBy: publishedAt_DESC) {
        id,
        title,
        slug,
        publishedAt,
        tags,
        extract
        createdAt
        coverImage {
          id,
          url,
          fileName,
        }
      }
    }
  `)
)
  .then((data) => data.data?.posts || [])
  .catch((error) => error);
---

<AstroLayout
  seo={{
    title: `Blog | Valerio Narcisi - web developer, director and screenwriter`,
    description:
      "Blog page of Valerio Narcisi web developer, director and screenwriter.",
    name: `Blog | Valerio Narcisi - Blog`,
    type: "website",
  }}
>
  <BlogComponent posts={posts} title="Blog" />
</AstroLayout>