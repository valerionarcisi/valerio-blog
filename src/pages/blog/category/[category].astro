---
import AstroLayout from "../../../layouts/layout.astro";
import Blog from "../../../components/Blog/Blog";
import {
  getAndParseHyGraphAbstractPost,
  type ExitTAbstractPost,
} from "../../../services/hygraph";
import { Effect, Exit } from "effect";

const { category } = Astro.params;
const posts = (await Effect.runPromiseExit(
  getAndParseHyGraphAbstractPost(`{
  posts(orderBy: publishedAt_DESC, where: {tags_contains_some: "${category}"}) {
        id,
        title,
        slug,
        publishedAt,
        tags,
        extract
        coverImage {
          id,
          url,
          fileName,
        }
      }
    }
  `)
)) as ExitTAbstractPost;


if (Exit.isFailure(posts)) return Astro.redirect("/404");
---

<AstroLayout
  seo={{
    title: `Category ${category} | Valerio Narcisi | Blog`,
    description: `Category: ${category} of the Valerio Narcisi blog`,
  }}
>
  <Blog posts={posts} title=`Category: ${category}` />
</AstroLayout>
