---
import AstroLayout from "../../../layouts/layout.astro";
import Blog from "../../../components/Blog/Blog";
import {
  getAndParseHyGraphAbstractPostByCategory,
  type ExitTAbstractPost,
} from "../../../services/hygraph";
import { Effect, Exit } from "effect";

const { category } = Astro.params;
if (!category) return Astro.redirect("/404");

const posts = (await Effect.runPromiseExit(
  getAndParseHyGraphAbstractPostByCategory(category)
)) as ExitTAbstractPost;

if (Exit.isFailure(posts)) return Astro.redirect("/404");

---

<AstroLayout
  seo={{
    title: `Category ${category} | Valerio Narcisi | Blog`,
    description: `Category: ${category} of the Valerio Narcisi blog`,
  }}
>
  <Blog posts={posts} title=`Category: ${category}` />
</AstroLayout>
