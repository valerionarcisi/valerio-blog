---
import AstroLayout from "../../../layouts/layout.astro";
import type { TPost } from "../../../models/model";
import Blog from "../../../components/Blog/Blog";
import { getAndParseHyAllPosts } from "../../../utils/hygraph";
import { Effect } from "effect";

const { category } = Astro.params;

const posts = await Effect.runPromise(
  getAndParseHyAllPosts(`{
  posts(orderBy: publishedAt_DESC, where: {tags_contains_some: "${category}"}) {
    id
    title
    slug
    publishedAt
    tags
    extract
    createdAt
    coverImage {
      id
      url
      fileName
    }
  }
}`)
)
  .then((data) => data.data?.posts || [])
  .catch((error) => error);

if (posts.length === 0) return Astro.redirect("/404");
---

<AstroLayout
  seo={{
    title: `Category ${category} | Valerio Narcisi | Blog`,
    description: `Category: ${category} of the Valerio Narcisi blog`,
  }}
>
  <Blog posts={posts} title=`Category: ${category}` />
</AstroLayout>
