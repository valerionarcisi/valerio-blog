---
import { Blog } from "../../../components";
import AstroLayout from "../../../layouts/layout.astro";
import {
  getAndParseHyGraphAbstractPostByCategory,
  getAllStaticPathsTags,
  type ExitTAbstractPost,
} from "../../../services/hygraph";
import { Effect, Exit } from "effect";

const { category } = Astro.params;
if (!category) return Astro.redirect("/404");

const posts = (await Effect.runPromiseExit(
  getAndParseHyGraphAbstractPostByCategory(category)
)) as ExitTAbstractPost;

if (Exit.isFailure(posts)) return Astro.redirect("/404");

export const prerender = true;
export const getStaticPaths = async () => {
  const routes = await Effect.runPromiseExit(getAllStaticPathsTags());
  if (Exit.isFailure(routes)) return [];
  return routes.value;
};
---

<AstroLayout
  seo={{
    title: `Category ${category} | Valerio Narcisi | Blog`,
    description: `Category: ${category} of the Valerio Narcisi blog`,
    name: `Blog | Valerio Narcisi - Blog`,
    type: "website",
  }}
>
  <Blog posts={posts} title=`Category: ${category}` />
</AstroLayout>
