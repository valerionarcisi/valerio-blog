---
import BaseHead from "~/components/BaseHead.astro";
import Header from "~/components/Header.astro";
import Footer from "~/components/Footer.astro";
import Title from "~/components/Title.astro";
import { getCollection } from "astro:content";
import { SITE_TITLE } from "~/consts";
import { getLangFromId, getSlugFromId } from "~/i18n/utils";

const allFilms = await getCollection("films");
const films = allFilms
  .filter(e => getLangFromId(e.id) === "it")
  .sort((a, b) => a.data.sortOrder - b.data.sortOrder);
---

<!doctype html>
<html lang="it">
  <head>
    <BaseHead title={`Film | ${SITE_TITLE}`} description="I cortometraggi di Valerio Narcisi" />
  </head>
  <body>
    <Header />
    <main>
      <Title title="Film" />
      <div class="films-grid">
        {films.map(film => (
          <a href={`/films/${getSlugFromId(film.id)}/`} class="film-card">
            <div class="film-card-img">
              <img src={film.data.coverImage} alt={film.data.title} />
              <div class="film-card-overlay"></div>
            </div>
            <div class="film-card-info">
              <h2>{film.data.title}</h2>
              <span class="year">{film.data.year}</span>
              <span class="role">{film.data.role}</span>
              {film.data.festivals.length > 0 && (
                <span class="festivals">{film.data.festivals.length} festival</span>
              )}
            </div>
          </a>
        ))}
      </div>
    </main>
    <Footer />
  </body>
</html>

<style>
  .films-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-large);
    max-width: 95%;
    margin: var(--space-large) auto;
  }

  .film-card {
    text-decoration: none;
    color: inherit;
    border-radius: var(--borderRadius-medium);
    overflow: hidden;
    background: var(--backgroundColor-secondary);
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  }

  .film-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--boxShadow-glow-warm);
  }

  .film-card:visited {
    color: inherit;
  }

  .film-card-img {
    position: relative;
    overflow: hidden;
  }

  .film-card-img img {
    width: 100%;
    aspect-ratio: 2.39 / 1;
    object-fit: cover;
    display: block;
    margin: 0;
    border-radius: 0;
  }

  .film-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      to top,
      rgba(10, 10, 12, 0.4) 0%,
      transparent 50%
    );
    pointer-events: none;
  }

  .film-card-info {
    padding: var(--space-medium) var(--space-large);
  }

  .film-card-info h2 {
    margin: 0 0 var(--space-small);
    font-size: var(--fontSize-large);
    color: var(--color-neutral);
  }

  .film-card-info .year {
    font-family: var(--fontFamily-mono);
    font-weight: 700;
    font-size: var(--fontSize-very-small);
    margin-right: var(--space-medium);
    color: var(--color-tertiary);
  }

  .film-card-info .role {
    font-family: var(--fontFamily-mono);
    font-style: italic;
    font-size: var(--fontSize-very-small);
    display: block;
    margin-top: var(--space-small);
    color: var(--color-secondary);
  }

  .film-card-info .festivals {
    display: inline-block;
    margin-top: var(--space-small);
    padding: 2px 10px;
    background: rgba(201, 168, 76, 0.15);
    border: 1px solid rgba(201, 168, 76, 0.3);
    color: var(--color-tertiary);
    border-radius: var(--borderRadius-small);
    font-family: var(--fontFamily-mono);
    font-size: var(--fontSize-very-small);
  }

  @media (min-width: 600px) {
    .films-grid {
      grid-template-columns: repeat(2, 1fr);
      max-width: 90%;
    }
  }

  @media (min-width: 1024px) {
    .films-grid {
      grid-template-columns: repeat(2, 1fr);
      max-width: 70%;
      gap: 2rem;
    }
  }
</style>
