---
import BaseHead from "~/components/BaseHead.astro";
import Header from "~/components/Header.astro";
import Footer from "~/components/Footer.astro";
import Title from "~/components/Title.astro";
import { getCollection } from "astro:content";
import { SITE_TITLE } from "~/consts";
import { getLangFromId, getSlugFromId } from "~/i18n/utils";

const allFilms = await getCollection("films");
const films = allFilms
  .filter(e => getLangFromId(e.id) === "en")
  .sort((a, b) => a.data.sortOrder - b.data.sortOrder);

let lastYear = 0;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={`Films | ${SITE_TITLE}`} description="Short films by Valerio Narcisi" />
  </head>
  <body>
    <Header />
    <main>
      <Title title="Films" />
      <div class="timeline">
        {films.map((film, i) => {
          const showYear = film.data.year !== lastYear;
          lastYear = film.data.year;
          const side = i % 2 === 0 ? "left" : "right";
          return (
            <>
              {showYear && (
                <div class="timeline-year">
                  <span>{film.data.year}</span>
                </div>
              )}
              <div class={`timeline-item ${side}`}>
                <a href={`/en/films/${getSlugFromId(film.id)}/`} class="timeline-content">
                  <div class="timeline-img">
                    <img src={film.data.coverImage} alt={film.data.title} />
                  </div>
                  <div class="timeline-info">
                    <h2>{film.data.title}</h2>
                    <span class="meta">
                      <span class="year">{film.data.year}</span>
                      <span class="role">{film.data.role}</span>
                    </span>
                    {film.data.festivals.length > 0 && (
                      <span class="festivals">{film.data.festivals.length} festivals</span>
                    )}
                  </div>
                </a>
                <div class="timeline-dot"></div>
              </div>
            </>
          );
        })}
      </div>
    </main>
    <Footer />
  </body>
</html>

<style>
  .timeline {
    position: relative;
    max-width: 1100px;
    margin: var(--space-large) auto;
    padding: 1rem 0 2rem;
  }

  .timeline::before {
    content: "";
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, transparent, var(--color-accent-cyan, #4ecdc4) 5%, var(--color-accent-cyan, #4ecdc4) 95%, transparent);
    transform: translateX(-50%);
  }

  .timeline-year {
    position: relative;
    text-align: center;
    margin: 2rem 0 1.5rem;
    z-index: 2;
  }

  .timeline-year:first-child {
    margin-top: 0;
  }

  .timeline-year span {
    display: inline-block;
    padding: 0.3rem 1.2rem;
    background: var(--color-tertiary, #c9a84c);
    color: #0a0a0c;
    font-family: var(--fontFamily-heading, 'Staatliches', Impact, sans-serif);
    font-size: 1.1rem;
    letter-spacing: 0.05em;
    border-radius: 20px;
  }

  .timeline-item {
    position: relative;
    width: 50%;
    margin-bottom: 2rem;
  }

  .timeline-item.left {
    padding-right: 2.5rem;
  }

  .timeline-item.right {
    margin-left: 50%;
    padding-left: 2.5rem;
  }

  .timeline-dot {
    position: absolute;
    top: 1.5rem;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--color-accent-cyan, #4ecdc4);
    border: 3px solid var(--color-tertiary, #c9a84c);
    z-index: 2;
  }

  .timeline-item.left .timeline-dot {
    right: -7px;
  }

  .timeline-item.right .timeline-dot {
    left: -7px;
  }

  .timeline-content {
    display: block;
    text-decoration: none;
    color: inherit;
    border-radius: var(--borderRadius-medium, 8px);
    overflow: hidden;
    background: var(--backgroundColor-secondary, #141416);
    border: 1px solid rgba(255, 255, 255, 0.06);
    transition: transform var(--transition-fast, 0.2s), box-shadow var(--transition-fast, 0.2s);
  }

  .timeline-content:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(201, 168, 76, 0.15);
  }

  .timeline-content:visited {
    color: inherit;
  }

  .timeline-img {
    position: relative;
    overflow: hidden;
  }

  .timeline-img img {
    width: 100%;
    aspect-ratio: 2.39 / 1;
    object-fit: cover;
    display: block;
    margin: 0;
    border-radius: 0;
  }

  .timeline-info {
    padding: var(--space-medium, 0.75rem) var(--space-large, 1rem);
  }

  .timeline-info h2 {
    margin: 0 0 var(--space-small, 0.25rem);
    font-size: var(--fontSize-medium, 1.1rem);
    color: var(--color-neutral, #e8e6e1);
  }

  .timeline-info .meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .timeline-info .year {
    font-family: var(--fontFamily-mono);
    font-weight: 700;
    font-size: var(--fontSize-very-small);
    color: var(--color-tertiary, #c9a84c);
  }

  .timeline-info .role {
    font-family: var(--fontFamily-mono);
    font-style: italic;
    font-size: var(--fontSize-very-small);
    color: var(--color-secondary);
  }

  .timeline-info .festivals {
    display: inline-block;
    margin-top: var(--space-small);
    padding: 2px 10px;
    background: rgba(201, 168, 76, 0.15);
    border: 1px solid rgba(201, 168, 76, 0.3);
    color: var(--color-tertiary);
    border-radius: var(--borderRadius-small);
    font-family: var(--fontFamily-mono);
    font-size: var(--fontSize-very-small);
  }

  @media (max-width: 700px) {
    .timeline::before {
      left: 20px;
    }

    .timeline-year {
      text-align: left;
      padding-left: 40px;
    }

    .timeline-item {
      width: calc(100% - 40px);
      margin-left: 40px !important;
      margin-right: 0 !important;
      padding-left: 1.5rem !important;
      padding-right: 0 !important;
    }

    .timeline-dot {
      left: -27px !important;
      right: auto !important;
    }
  }
</style>
