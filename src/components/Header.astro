---
import { Image } from "astro:assets";
import HeaderLink from "~/components/HeaderLink.astro";
import "~/components/Header.css";

const currentPath = Astro.url.pathname;
const isEn = currentPath.startsWith('/en');
const otherLang = isEn ? 'IT' : 'EN';

const routeMap: Record<string, string> = {
  '/contatti': '/en/contact',
  '/en/contact': '/contatti',
};

function getLangSwitchHref(path: string): string {
  const normalized = path.replace(/\/$/, '') || '/';
  if (routeMap[normalized]) return routeMap[normalized] + '/';
  if (isEn) return (normalized.replace(/^\/en/, '') || '/');
  return `/en${normalized}`;
}

const langSwitchHref = getLangSwitchHref(currentPath);
---

<header class="Header">
  <div class="logo-container">
    <HeaderLink href="/" class="logo">
      <Image src="/img/me.jpg" alt="Logo Valerio Narcisi" width={32} height={32} loading="eager" />
      <div>Valerio Narcisi</div>
    </HeaderLink>
  </div>
  <div class="header-controls">
    <div class="menu-toggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <nav>
    <HeaderLink href={isEn ? "/en" : "/"}>Home</HeaderLink>
    <HeaderLink href={isEn ? "/en/blog" : "/blog"}>Blog</HeaderLink>
    <HeaderLink href={isEn ? "/en/films" : "/films"}>{isEn ? "Films" : "Film"}</HeaderLink>
    <HeaderLink href={isEn ? "/en/who-i-am" : "/who-i-am"}>{isEn ? "Who I Am" : "Chi Sono"}</HeaderLink>
    <HeaderLink href={isEn ? "/en/contact" : "/contatti"}>{isEn ? "Contact" : "Contatti"}</HeaderLink>
    <a href={langSwitchHref} class="lang-switch">{otherLang}</a>
  </nav>
</header>

<script>
  const menuToggle = document.querySelector(".menu-toggle");
  const nav = document.querySelector("nav");

  menuToggle?.addEventListener("click", () => {
    menuToggle.classList.toggle("active");
    nav?.classList.toggle("active");
  });
</script>
