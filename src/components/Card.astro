---
import { Image } from "astro:assets";
import FormattedDate from "~/components/FormattedDate.astro";
import "~/components/Card.css";
import Tag from "~/components/Tag.astro";

interface Props {
  title: string;
  extract: string;
  date: string;
  coverImage: string;
  tags: string[];
  slug: string;
  lang?: string;
}

const { title, extract, date, coverImage, tags, slug, lang = "it" } = Astro.props;

const blogPrefix = lang === "it" ? "/blog" : `/en/blog`;

const optimizedExtract = extract.length > 120
  ? extract.substring(0, 117) + "..."
  : extract;
---

<a href={`${blogPrefix}/${slug}/`} class="Card">
  <div class="card-img">
    {coverImage && <Image src={coverImage} alt={title} width={600} height={340} loading="lazy" />}
    <div class="card-overlay"></div>
    <div class="card-glitch"></div>
    <div class="card-pixelate"></div>
  </div>
  <div class="card-body">
    <div class="card-meta">
      <span class="card-date"><FormattedDate date={new Date(date)} /></span>
      <div class="card-tags">
        {tags.slice(0, 2).map((tag: string) => <Tag tag={tag} lang={lang} asSpan={true} />)}
      </div>
    </div>
    <h3 class="card-title">{title}</h3>
    <p class="card-extract">{optimizedExtract}</p>
  </div>
</a>
