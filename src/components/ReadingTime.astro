---
interface Props {
  content: string;
  wordsPerMinute?: number;
}

const { content, wordsPerMinute = 200 } = Astro.props;

function calculateReadingTime(text: string, wpm: number): number {
  // Remove HTML tags and normalize whitespace
  const cleanText = text.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
  
  // Count words (split by whitespace and filter out empty strings)
  const wordCount = cleanText.split(' ').filter(word => word.length > 0).length;
  
  // Calculate reading time in minutes, minimum 1 minute
  const readingTime = Math.max(1, Math.ceil(wordCount / wpm));
  
  return readingTime;
}

const readingTime = calculateReadingTime(content, wordsPerMinute);
const readingTimeText = readingTime === 1 ? '1 min read' : `${readingTime} min read`;
---

<span class="reading-time" title={`Estimated reading time: ${readingTimeText}`}>
  <span class="reading-time-icon">ðŸ“–</span>
  <span class="reading-time-text">{readingTimeText}</span>
</span>

<style>
  .reading-time {
    display: inline-flex;
    align-items: center;
    gap: var(--space-small);
    font-family: var(--fontFamily-mono);
    font-size: var(--fontSize-very-small);
    color: #e8e6e1;
    background-color: rgba(10, 10, 12, 0.75);
    padding: var(--space-small) 0.5rem;
    border-radius: var(--borderRadius-small);
    backdrop-filter: blur(4px);
  }

  .reading-time-icon {
    font-size: var(--fontSize-very-small);
    opacity: 0.8;
  }

  .reading-time-text {
    font-weight: var(--fontWeight-400);
  }

</style>